buildscript {
    repositories {
      mavenLocal()
      mavenCentral()
      jcenter()
    }

    dependencies {
      classpath 'au.com.dius:pact-jvm-provider-gradle_2.11:3.3.1'
      classpath 'io.ratpack:ratpack-gradle:1.2.0'
      classpath 'com.tkruse.gradle:gradle-groovysh-plugin:1.0.7'
    }
}

apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'au.com.dius.pact'
apply plugin: 'io.ratpack.ratpack-groovy'
apply plugin: 'com.github.tkruse.groovysh'

version = '1.0'

repositories {
  mavenLocal()
  mavenCentral()
  jcenter()
}

dependencies {
  runtime 'ch.qos.logback:logback-core:1.1.7',
    'ch.qos.logback:logback-classic:1.1.7',
    'org.codehaus.groovy.modules.http-builder:http-builder:0.7.1'
  testCompile 'au.com.dius:pact-jvm-provider-junit_2.11:3.3.1',
    'commons-codec:commons-codec:1.10'
}

test {
  systemProperties['pact.verification.reports'] = ''
}

pact {
    serviceProviders {
        'Activity Service' {
            port = 5050
            stateChangeUrl = url('http://localhost:5050/tasks/pactStateChange')
            stateChangeUsesBody = false

//            hasPactWith("sampleconsumer") {
//                pactFile = { new File('src/test/resources/sample-pact.json') }
//            }
//
//            hasPactWith("sampleconsumer2") {
//                pactFile = file('src/test/resources/sample-pact2.json')
//            }
//
//            hasPactWith("sampleconsumerV3") {
//                pactFile = file('src/test/resources/sample-pact-v3.json')
//            }

//          verificationType = "ANNOTATED_METHOD"
//          hasPactsFromPactBroker('http://localhost:80/')

            hasPactWith("wildcardkeys") {
                pactFile = file('src/test/resources/WildcardKeysConsumer-WildcardKeysProvider.json')
            }
        }
    }

    reports {
      defaultReports()

      markdown
      json
    }

  publish {
    pactDirectory = 'src/test/resources'
    pactBrokerUrl = 'http://localhost'
  }
}

groovysh {
  // groovyVersion determines the features of the shell and buildShell tasks.
  groovyVersion = '2.4.3'
}
