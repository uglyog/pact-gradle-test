buildscript {
    repositories {
      mavenLocal()
      mavenCentral()
      jcenter()
      maven { url 'https://jitpack.io' }
    }

    dependencies {
      classpath 'au.com.dius:pact-jvm-provider-gradle_2.12:3.5.24'
      classpath 'io.ratpack:ratpack-gradle:1.5.4'
      classpath 'org.slf4j:jcl-over-slf4j:1.7.25'
    }
}

apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'au.com.dius.pact'
apply plugin: 'io.ratpack.ratpack-groovy'

version = '1.0.2'

repositories {
  mavenLocal()
  mavenCentral()
  jcenter()
}

dependencies {
  runtime 'ch.qos.logback:logback-core:1.1.7',
    'ch.qos.logback:logback-classic:1.1.7',
    'org.codehaus.groovy.modules.http-builder:http-builder:0.7.1'
  testCompile 'au.com.dius:pact-jvm-provider-junit_2.12:3.6.1',
    'commons-codec:commons-codec:1.10'
}

test {
  systemProperties['pact.verification.reports'] = ''
}

pact {
    serviceProviders {
        'ArraysProvider' {
            port = 5050
//            stateChangeUrl = url('http://localhost:5050/tasks/pactStateChange')
//            stateChangeUsesBody = false
//            requestFilter = { req ->
//              req.addHeader('Authorization', 'Basic dGVzdDAwMzoxMjM0NTY=')
//            }
//
//            hasPactWith("Foo Web Client") {
//              pactSource = file('src/test/resources/publish/null-fields.json')
//            }
//
//            hasPactWith("Foo Web Client 2") {
//                pactFile = file('src/test/resources/sample-pact-v3.json')
//            }

//            hasPactWith("sampleconsumerS3") {
//                pactFile = 's3://irexchange-pacts/craft-mobile/test_consumer-testProvider.json'
//            }

//            hasPactsWith("test_consumer", authentication: ['mysecret']) {
//              pactFileLocation = url("s3://....")
//            }

//          verificationType = "ANNOTATED_METHOD"
//          hasPactWith("messageProvider") {
//              pactSource = file('src/test/resources/v3-message-pact.json')
//          }

//          hasPactsFromPactBroker('http://localhost:5050/')

//          hasPactWith("wildcardkeys") {
//              pactSource = file('src/test/resources/WildcardKeysConsumer-WildcardKeysProvider.json')
//          }

          hasPactWith("Test Client") {
              pactSource = { file('src/test/resources/wild-card-key-pact.json') }
          }

//          hasPactsWith('group') {
//            pactFileLocation = file('src/test/resources/publish')
//          }

//          hasPactWith('JVM Pact Broker Client') {
//            pactSource = file('src/test/resources/JVM Pact Broker Client-Pact Broker.json')
//          }

//          hasPactWith('arrays') {
//            pactSource = file('src/test/resources/array-validation-test.json')
//          }

        }

//      'zoo-provider' {
//        port = 5050
//        hasPactWith("zoo-client") {
//          pactSource = { file('src/test/resources/zoo-client-zoo-ws.json') }
//        }
//      }

    }

    reports {
      defaultReports()

      markdown
      json
    }

  publish {
    pactDirectory = 'multi-test/test1'
    pactBrokerUrl = 'http://test1.docker.localhost'
  }
}
